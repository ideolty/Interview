# 系统

## 系统莫名无响应

**现象描述**

业务系统重启后，几分钟后，前端调用接口就发现后端接口无响应，重启服务后，系统恢复正常，但是很快又无响应了。



**排查**

- 在问题发生后登陆服务器ps -ef查看用户进程，发现程序进程还在，top命令没有观察到明显的异常。
- 查看微服务日志与网关日志，观察到网关向微服务转发的请求全部超时，微服务无任何日志打印。
- 不通过网关，直接调用微服务接口，无日志。
- 网关telnet微服务正常。



至此，没有发现任何可疑的地方，仿佛一切都是正常的，所以我再一次重启了系统，并持续关注日志。

- 重启1分钟之后出现了大量的日志打印，查看日志发现了大段大段的sql语句，连忙down下日志文件打算细看。

- 此时，队友有了新发现，队友在看到如此大量的查询时，第一反应是怀疑数据库资源不够，于是打开Navicat查看了数据库状态，果然发现了在一个小时内有大量的锁没有释放。

- 查看造成加锁的语句

  ```sql
  UPDATE meta_table_info set description = $1,update_time=$2,update_by=$3 where 1=1 and id=$4
  ```

  往上追溯接口掉用链，发现是在批量更新元数据表信息的接口发起了本次查询。

- 把数据库锁解掉，微服务恢复了正常。



**疑问**

1. 如果是数据库链接数不够了或者是表级别的死锁，那为什么网关的请求会超时，难道是jdbc链接的超时时间设置过长吗？





## 业务难点

- 数据的增量交换，增量字段，业务主键，技术主键。
- 采集库内数据物理删除，目标库内的数据同步问题
- 异构数据源字段大小写问题
- 各种兼容问题，中心式与分布式交换兼容，多数据库兼容，多种交换方式（cdc/etl）兼容
- 元数据、编目、交换申请的版本管理、各个版本间的对比与联动







# spring

## 循环依赖

**现象描述**

在boot项目启动时报循环依赖。在本地使用IDE启动没有问题，在Linux服务器上启动就抛异常。我在拦截器xxxxInterceptor中，autowire了一个feign接口。



**原因**

未知，不知道为什么不能在Interceptor中注入feign接口



**解决**

从springcontext上下文中获取此bean

